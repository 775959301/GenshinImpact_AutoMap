# 原神自动地图（Genshin Impact Auto Map）
原神自动地图，基于原神小地图的自动标记资源地图

目前做成了原神的PC端悬浮窗地图工具……（但也实现了自动跟踪的功能）

链接：https://pan.xunlei.com/s/VMRzpFyq2hmpeYjTydWOos2mA1
提取码：4b3u

## 运行画面

![运行画面](https://github.com/GengGode/GenshinImpact_AutoMap/blob/master/GenshinImpact_Map_Test_1/Img/Snipaste_2021-01-07_15-09-00.png)

## 目前实现

地图显示（平移、缩放）

中键移动窗口位置（有Bug，会闪）

左键双击右上角退出

双击开启自动追踪，悬浮窗会自动显示角色所在位置的地图，但是会很卡，很卡，很卡。。。

（测试版还有过一次吃掉12个G内存的壮举，不过已经修复了。）

检测游戏状态（游戏全屏下会失效，启动的过程中进入游戏，不然可能游戏跟悬浮窗都显示不出来）

可以添加标记（代码里）

通过游戏内小地图，自动识别角色所在位置

在某些情况下自动隐藏悬浮窗，如传送时，打开大地图时，释放大招时……

修复了悬浮窗自动复位时，键鼠焦点转移，导致弹出输入法的问题。

## 计划实现

缩放改为以指针为中心

添加标记改为自动

根据数据库显示周围资源分布

优化UI

## 更远的计划

利用MFC或者Qt重写一个窗口，不再使用OpenCV提供的窗口，以便实现不规则窗口和边缘半透明效果

根据另一个做的小地图自动识别来看，还得优化自动识别的速度

## 一些已知的问题

游戏全屏时，因为悬浮窗处于置顶状态，悬浮窗和原神会争抢顶层窗口的位置，以至于游戏来回全屏和最小化。

推测可能是原神的问题，在双屏幕时全屏原神，在另一个屏幕上鼠标点击，原神就会最小化，然而B服原神不会。

经测试B服可以在全屏下使用，官服不行（令人迷惑.jpg）。

中键拖动窗口会闪烁，这个是由于OpenCV的鼠标回调返回的鼠标位置是基于窗口左上角的，拖动的话，在窗口移动时，鼠标的坐标是不变的，有点难以处理，用MFC或者Qt重写了可能会好些吧。
